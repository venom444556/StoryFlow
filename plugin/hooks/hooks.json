{
  "description": "StoryFlow closed-loop board sync — keeps the board in sync with actual work automatically",
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "ExitPlanMode",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "A plan was just approved. Sync it to StoryFlow: (1) Call storyflow_list_projects to check connectivity. If unreachable or unconfigured, skip silently. (2) Find or pick the relevant project. (3) Call storyflow_list_issues to see what already exists. (4) For each planned work item that does NOT have a matching issue, CREATE one using storyflow_create_issue (type: story or task, status: 'In Progress'). Group under an epic if the plan is large — create the epic first, then child issues with epicId. (5) For existing issues that match planned work and are 'To Do', move them to 'In Progress' via storyflow_update_issue. The board should fully reflect the approved plan before work begins.",
            "timeout": 30
          }
        ]
      },
      {
        "matcher": "TodoWrite",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "The todo list was just updated. Sync it to StoryFlow: (1) Call storyflow_list_projects to check connectivity. If unreachable or unconfigured, skip silently. (2) Call storyflow_list_issues on the relevant project. (3) For each NEW todo that has no matching StoryFlow issue, CREATE one via storyflow_create_issue — use type 'task' for small items, 'story' for features, 'bug' for fixes. If todos are grouped under a theme, create an epic first and link children with epicId. Set status to match the todo: pending → 'To Do', in_progress → 'In Progress', completed → 'Done'. (4) For each todo whose status CHANGED, find the matching StoryFlow issue and update its status to match (To Do / In Progress / Done). (5) For any todo that was REMOVED from the list, leave its StoryFlow issue as-is (do not delete). Keep the board in sync with the todo list at all times.",
            "timeout": 30
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "input=$(cat); cmd=$(echo \"$input\" | grep -o '\"command\":\"[^\"]*\"' | head -1 | sed 's/\"command\":\"//;s/\"$//'); if echo \"$cmd\" | grep -qE 'git commit'; then echo '{\"systemMessage\": \"STORYFLOW BOARD SYNC: You just committed code. Update the board: (1) Use storyflow_list_issues to find issues related to this commit. (2) Move completed issues to Done. (3) If this commit represents work with NO matching issue, create one via storyflow_create_issue with status Done so the board reflects reality. Skip silently if StoryFlow is not configured.\"}'; fi",
            "timeout": 5
          }
        ]
      }
    ],
    "Stop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Before ending this session, reconcile the StoryFlow board if a StoryFlow project is active. Call storyflow_list_projects — if reachable and a project relates to this session's work, call storyflow_list_issues and check: (1) Are any issues still 'To Do' that were actually worked on? Move to 'In Progress' or 'Done'. (2) Are any issues 'In Progress' that are now complete? Move to 'Done'. (3) Was unplanned work done that has no issue? Consider creating one marked 'Done'. Report what you updated. If StoryFlow is not configured or unreachable, approve the stop and skip silently.",
            "timeout": 30
          }
        ]
      }
    ]
  }
}
